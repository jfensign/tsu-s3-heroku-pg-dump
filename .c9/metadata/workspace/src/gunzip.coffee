{"filter":false,"title":"gunzip.coffee","tooltip":"/src/gunzip.coffee","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"start":{"row":0,"column":0},"end":{"row":36,"column":33},"action":"insert","lines":["zlib = require 'zlib'","","_ = require 'underscore'","","fs = require 'fs'","","request = require 'request'","","do ->","\trequest_opts =","\t\turl: process.env[\"ARCHIVE_URI\"] or \"https://s3.amazonaws.com/tsu-notifications-production-backup/bk20141111-195743-7621808-tsu-notifications-new-prod-db-1_of_1-30246-1-4096.rdb.gz\"","","\tstream = request request_opts","","\tgunzip = do zlib.createGunzip","","\tgunzip.on 'open', ->","\t\tconsole.log '%s', 'gunzip started'","","\tgunzip.on 'close', ->","\t\tconsole.log '%s', 'GZ Extracted'","","\twriter = fs.createWriteStream do ->","    \ttmp = _.last(request_opts.url.split '/').split '.'","    \tdo tmp.pop","    \ttmp.join '.'","","    writer.on 'data', (chunk) ->","    \tconsole.log chunk","","    writer.on 'error', (e) ->","    \tconsole.error e","","    writer.on 'close', ->","    \tconsole.log 'done'","","\t(stream.pipe gunzip).pipe writer"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":36,"column":33},"end":{"row":36,"column":33},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1416264765584,"hash":"0a6b2b2a28dca4e0b6a984603419e7e2e92f9d3d"}