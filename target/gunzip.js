// Generated by CoffeeScript 1.7.1
(function() {
  var fs, request, zlib, _;

  zlib = require('zlib');

  _ = require('underscore');

  fs = require('fs');

  request = require('request');

  (function() {
    var gunzip, request_opts, stream, writer;
    request_opts = {
      url: process.env["ARCHIVE_URI"] || "https://s3.amazonaws.com/tsu-notifications-production-backup/bk20141111-195743-7621808-tsu-notifications-new-prod-db-1_of_1-30246-1-4096.rdb.gz"
    };
    stream = request(request_opts);
    gunzip = zlib.createGunzip();
    gunzip.on('open', function() {
      return console.log('%s', 'gunzip started');
    });
    gunzip.on('close', function() {
      return console.log('%s', 'GZ Extracted');
    });
    writer = fs.createWriteStream((function() {
      var tmp;
      tmp = _.last(request_opts.url.split('/')).split('.');
      tmp.pop();
      return tmp.join('.');
    })());
    writer.on('data', function(chunk) {
      return console.log(chunk);
    });
    writer.on('error', function(e) {
      return console.error(e);
    });
    writer.on('close', function() {
      return console.log('done');
    });
    return (stream.pipe(gunzip)).pipe(writer);
  })();

}).call(this);
